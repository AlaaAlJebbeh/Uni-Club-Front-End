
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Font Linking -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet" />

  <!-- Style Linking -->
  <link rel="stylesheet" href="../public/styles/myclubpage.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"> 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
  <!-- Header -->
  <header>
    <% if(loggedIn) { %> <%- include("partials/club_header.ejs", {loggedIn: true}); %>
        <% } else { %> <%- include("partials/header.ejs"); %>
            <% } %>
  </header>

  <!-- My Club Header Part -->
  <div class="container1">
    <div class="sidebar1">
      <div class="items">
        <div class="icon">
          <img src="../public/images/myClubAssets/profile33.png" />
        </div>
        <a href="#" id="my-profile-link" style="text-decoration: none; color: white;">
          <% if(loggedIn) { %>My <% } else { %> Club <% } %> Profile
        </a>
      </div>
      <div class="items">
        <div class="icon">
          <img src="../public/images/myClubAssets/event2.png" />
        </div>
        <a id="my-events-link" style="text-decoration: none; color: white;">
          <% if(loggedIn) { %>My <% } else { %> Club <% } %> Events
        </a>
      </div>
      <div class="items">
        <div class="icon">
          <img src="../public/images/myClubAssets/post2.png" />
        </div>
        <a href="#" id="my-posts-link" style="text-decoration: none; color: white;">
          <% if(loggedIn) { %>My <% } else { %> Club <% } %> Posts
        </a>
      </div>
      <% if (loggedIn) { %>
        <div class="items" id="status-item">
          <div class="icon">
            <img src="../public/images/myClubAssets/status.png" />
          </div>
          <a href="/statusClubManager" id="my-status-link" style="text-decoration: none; color: white;">Status Manager</a>
        </div>
        <div class="items">
          <div class="icon">
            <img src="../public/images/myClubAssets/notification.png" />
          </div>
          <a href="#" id="club-notifications-link" style="text-decoration: none; color: white;">Club Notifications</a>
        </div>
        <% } %>
    </div>

    <div class="ContentBody">
      <div id="my-profile-content" class="content-section" style="display: block">
        <div class="cnt1">
          <div class="logo-side">
            <% console.log(clubInformation[0].clubImageUrl) %>
            <img src="../public/images/<%= clubInformation[0].clubImageUrl %>" alt="Image not loading" />
          </div>
        </div>

        <% if (loggedIn) { %>
          <div class="cnt6">
            <div class="logo-side1">
                <a href="/createevent"><button>Create Event</button></a>
                <p></p>
                <a href="/notifications"><button>Notifications</button></a>
                <p></p>
                <a href="/createPost"><button>createPost</button></a>

            </div>
          </div>
          <% } %>

            <h1 style="text-align: center; font-size: 36px; margin-bottom: 75px">
              Club Information
            </h1>

            <form id="profileForm" method="POST" action="/updateProfile" class="content-container" target="/myclubpage" enctype="multipart/form-data">
              <% if (loggedIn) { %>
                <div class="profileImage">
                  <input type="file" name="uploadImage1" id="clubprofileimage"/>
                </div>
                <% } %>
              <div class="cnt2">
                <h1>
                  <span style="color: #193635">Club Name:</span>
                  <span contenteditable="<%= loggedIn %>" id="clubNameField" data-field="club_name">
                    <%= clubInformation[0].club_name %>
                  </span>
                  <input type="hidden" name="club_name_field" value="club_name" />
                  <input type="hidden" name="club_name_content" id="clubNameContent" />
                </h1>
                <h1>
                  Category:
                  <strong contenteditable="<%= loggedIn %>" id="categoryField">
                    <%= clubInformation[0].category %>
                  </strong>
                  <input type="hidden" name="category_field" value="category" />
                  <input type="hidden" name="category_content" id="categoryContent" />
                </h1>
              </div>
              <div class="cnt3">
                <h1 style="margin-right: 15px">BIO:</h1>
                <div class="bio-textbox" contenteditable="<%= loggedIn %>" placeholder="Enter your bio here"
                  id="bioField">
                  <%= clubInformation[0].bio %>
                </div>
                <input type="hidden" name="bio_field" value="bio" />
                <input type="hidden" name="bio_content" id="bioContent" />
              </div>
              <div class="cnt4">
                <h2>Social Media / Contact Info</h2>
                <div class="contact-info">
                  <img src="../public/images/myClubAssets/email.png" />
                  <div class="Email" style="font-size: 20px" contenteditable="<%= loggedIn %>" id="emailField">
                    <%= clubInformation[0].email %>
                  </div>
                  <input type="hidden" name="email_field" value="email" />
                  <input type="hidden" name="email_content" id="emailContent" />
                </div>
              </div>
              <% if (loggedIn) { %>
                <button type="submit" id="saveButton">Save</button>
                <% } %>
            </form>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script>
              $(document).ready(function () {
                $("#saveButton").on("click", function () {
                  var hasChanges = false; // Flag to track if there are any edits

                  // Check if an image is uploaded
                  var fileInput = document.getElementById("clubprofileimage");
                  if (fileInput.files.length > 0) {
                    console.log("inside")
                    hasChanges = true;
                  } 
                  // Update club name content (check for changes)
                  var clubNameContent = $("#clubNameField").text();
                  var originalClubNameContent = $("#clubNameField").attr("data-original-content");
                  if (clubNameContent !== originalClubNameContent) {
                    $("#clubNameContent").val(clubNameContent);
                    hasChanges = true;
                  } else {
                    $("#clubNameContent").val('');
                  }

                  // Update category content (check for changes)
                  var categoryContent = $("#categoryField").text();
                  var originalCategoryContent = $("#categoryField").attr("data-original-content");
                  if (categoryContent !== originalCategoryContent) {
                    $("#categoryContent").val(categoryContent);
                    hasChanges = true;
                  } else {
                    $("#categoryContent").val('');
                  }

                  // Update bio content (check for changes)
                  var bioContent = $("#bioField").text();
                  var originalBioContent = $("#bioField").attr("data-original-content");
                  if (bioContent !== originalBioContent) {
                    $("#bioContent").val(bioContent);
                    hasChanges = true;
                  } else {
                    $("#bioContent").val('');
                  }

                  // Update email content (check for changes)
                  var emailContent = $("#emailField").text();
                  var originalEmailContent = $("#emailField").attr("data-original-content");
                  if (emailContent !== originalEmailContent) {
                    $("#emailContent").val(emailContent);
                    hasChanges = true;
                  } else {
                    $("#emailContent").val('');
                  }

                  if (hasChanges) {
                    $("#profileForm").submit();
                  } else {
                    // Handle no changes scenario (optional: display a message)
                    console.log("No changes detected in the form.");
                  }
                });
              });
            </script>
           
            <hr />
            <h1 style="text-align: center; font-size: 36px; margin-bottom: 75px">
              Club Manager Information
            </h1>

            <div class="content-containerManager">
              <% clubManager.forEach((item)=> { %>
                <div class="CLMNAMES">
                  <img src="../public/images/<%= item.imageURL%>" />
                  <h2>
                    <span style="color: #193635">Club Manager Name:</span><br />
                    <%=item.name%>
                  </h2>
                  <% if(loggedIn) { %>
                  <form action = "/updatePictureManager" method="post" style="all:initial" enctype="multipart/form-data">
                    <div>
                      <input type="file" name="uploadImage1" />
                    </div>

                    <button type="submit" class="uploadbutton">Upload</button>
                    </form>
                    <% } %>
                </div>
                <% }); %>
            </div>
      </div>

      <div id="my-events-content" class="content-section" style="display: none">
        <h1 style="text-align: center; font-size: 36px">Events</h1>
        <div class="card-container">
          <% event.forEach((item, index)=> { %>
            <div class="indivisual-card-container">
            <div class="card">
              <div class="image-container">
                <img class="eventImage" src="../public/images/<%=item.imageURL%>" id="clubImage-<%=item.event_id%>"/>
                <% const currentDate = new Date();
                currentDate.setHours(0, 0, 0, 0); const eventDate = new
                Date(item.date); eventDate.setHours(0, 0, 0, 0); if
                (currentDate.getTime() === eventDate.getTime()) { %>
                <div class=" Active">Active</div>
              <% } else if (currentDate.getTime()> eventDate.getTime()) { %>
                <div class="canceled">Finished</div>
                <% } else { %>
                  <div class="not-active">SOON</div>
                  <% } %>

                <% if(loggedIn) { %>
                <div class="editanddeleteContainer">
                  <div class="image">
                    <button type="submit" style="background-color: white; border:none;">
                      <img src="../public/images/edit.png" alt="edit icon" class="edit-icon" data-eventid="<%= item.event_id %>" style="background-color: aliceblue;"/>
                    </button>
                  </div>
                  <% var eventID=parseInt(item.event_id); %>
                  <form action="/deleteEvent?eventID=<%=eventID%>" method="post" sty>
                    <button type="submit" style="background-color: white; border:none;">
                      <img src="../public/images/delete.png" alt="delete icon"/>
                    </button>
                  </form>
                 
                   <form action="/album" method="get" class="see-button" style="all: initial;"> 
                   <button id="<%= item.event_id %>" name="event_id" value="<%= item.event_id %>"  onclick="album()">
                   <img src="../public/images/eye_icon.png" style="background-color: aliceblue;">
                   </button>
                    </form>

                    <form action="/createAlbum" method="GET" class="add-button" style="all: initial;">
                    <button id="<%= item.event_id %>" name="event_id" value="<%= item.event_id %>">
                    <img src="../public/images/add_icon.png" style="background-color: aliceblue;">
                    </button>
                    </form>

                  
                </div>
                <% } %>
              </div>
              <!-- Inside the HTML template -->
              <div class="text-container" id="text-container-<%= item.event_id %>">
                  <form id="edit-form-<%= item.event_id %>" class="text-container" method="POST" action="/updateEvent" enctype="multipart/form-data">
                    <div class="upload image" id="upload-button-<%= item.event_id %>" >
                      <input type="file" name="uploadImage1" />
                    </div>
                    <input type="hidden" name="eventID" value="<%= item.event_id %>">
                    <input type="hidden" name="clubImage" value="" id="clubimageInput_<%= item.event_id %>">
                    <div class="card-details">
                      <span>Club Name:</span>
                      <span class="club-name" contenteditable="false" id="clubName_<%= item.event_id %>"><%= clubInformation[0].club_name %></span>
                      <input type="hidden" name="clubName" value="<%= clubInformation[0].club_name %>" id="clubNameInput_<%= item.event_id %>" />
                  </div>
                  <div class="card-details">
                      <span>Event Name:</span>
                      <span class="event-name" contenteditable="false" id="eventName_<%= item.event_id %>"><%= item.event_name %></span>
                      <input type="hidden" name="eventName" value="<%= item.event_name %>" id="eventNameInput_<%= item.event_id %>" />
                  </div>
                  <!--Date-->
                  <div class="card-details">
                    <span>Date:</span>
                    <span class="event-date" contenteditable="false" id="eventDate_<%= item.event_id %>">
                        <%= item.date.toISOString().split('T')[0] %>
                    </span>
                    <input type="hidden" name="eventDate" value="<%= item.date.toISOString().split('T')[0] %>" id="eventDateInput_<%= item.event_id %>" />
                  </div>
                  <div class="card-details">
                      <span>Time:</span>
                      <span class="event-time" contenteditable="false" id="eventTime_<%= item.event_id %>"><%= item.time %></span>
                      <input type="hidden" name="eventTime" value="<%= item.time %>" id="eventTimeInput_<%= item.event_id %>" />
                  </div>
              
                  <!-- Location -->
                  <div class="card-details">
                      <span>Location:</span>
                      <span class="event-location" contenteditable="false" id="eventLocation_<%= item.event_id %>"><%= item.location %></span>
                      <input type="hidden" name="eventLocation" value="<%= item.location %>" id="eventLocationInput_<%= item.event_id %>" />
                  </div>
              
                  <!-- Language -->
                  <div class="card-details">
                      <span>Language:</span>
                      <span class="event-language" contenteditable="false" id="eventLanguage_<%= item.event_id %>"><%= item.language %></span>
                      <input type="hidden" name="eventLanguage" value="<%= item.language %>" id="eventLanguageInput_<%= item.event_id %>" />
                  </div>
              
                  <!-- Guest -->
                  <div class="card-details">
                      <span>Guest:</span>
                      <span class="event-guest" contenteditable="false" id="eventGuest_<%= item.event_id %>"><%= item.guest_name %></span>
                      <input type="hidden" name="eventGuest" value="<%= item.guest_name %>" id="eventGuestInput_<%= item.event_id %>" />
                  </div>

                  <!-- Category -->
                  <div class="card-details">
                      <span>Category:</span>
                      <span class="event-Category" contenteditable="false" id="eventCategory_<%= item.event_id %>"><%= item.category %></span>
                      <input type="hidden" name="eventCategory" value="<%= item.category %>" id="eventCategoryInput_<%= item.event_id %>" />
                  </div>
              
                  <!-- Description -->
                  <div class="card-details">
                      <span>Description:</span>
                      <span class="event-description" contenteditable="false" id="eventDescription_<%= item.event_id %>"><%= item.description %></span>
                      <input type="hidden" name="eventDescription" value="<%= item.description %>" id="eventDescriptionInput_<%= item.event_id %>" />
                  </div>
              
                  <!-- Capacity -->
                  <div class="card-details">
                      <span>Capacity:</span>
                      <span class="event-capacity" contenteditable="false" id="eventCapacity_<%= item.event_id %>"><%= item.capacity %></span>
                      <input type="hidden" name="eventCapacity" value="<%= item.capacity %>" id="eventCapacityInput_<%= item.event_id %>" />
                  </div>
              
                  <!-- Notes -->
                  <div class="card-details">
                      <span>Notes:</span>
                      <span class="event-notes" contenteditable="false" id="eventNotes_<%=item.event_id %>"><%=item.notes %></span>
                      <input type="hidden" name="eventNotes" value="<%=item.notes %>" id="eventNotesInput_<%=item.event_id %>" />
                  </div>
                  <button type="button" class="events-save-button" data-eventid="<%=item.event_id %>">Save</button>
                  
              </div>
            </div>
            <button type="submit" class="events-save-button" data-eventid="<%= item.event_id %>" id="save-button-<%= item.event_id %>">Save</button>
              </form>
          
<script>
  document.addEventListener("DOMContentLoaded", function() {
      const saveButtons = document.querySelectorAll('.events-save-button');
      saveButtons.forEach(button => {
          button.addEventListener('click', function() {
              const eventID = this.getAttribute('data-eventid');

              // Get the form corresponding to the event ID
              const form = document.getElementById(`edit-form-${eventID}`);

              // Update club name
              const clubName = document.getElementById(`clubName_${eventID}`).innerText;
              document.getElementById(`clubNameInput_${eventID}`).value = clubName;

              // Update event name
              const eventName = document.getElementById(`eventName_${eventID}`).innerText;
              document.getElementById(`eventNameInput_${eventID}`).value = eventName;

              // Update event date
              const eventDate = document.getElementById(`eventDate_${eventID}`).innerText;
              document.getElementById(`eventDateInput_${eventID}`).value = eventDate;

              // Update event time
              const eventTime = document.getElementById(`eventTime_${eventID}`).innerText;
              document.getElementById(`eventTimeInput_${eventID}`).value = eventTime;

              // Repeat similar steps for other fields
               // Update location
              const eventLocation = document.getElementById(`eventLocation_${eventID}`).innerText;
              document.getElementById(`eventLocationInput_${eventID}`).value = eventLocation;

              // Update language
              const eventLanguage = document.getElementById(`eventLanguage_${eventID}`).innerText;
              document.getElementById(`eventLanguageInput_${eventID}`).value = eventLanguage;

              // Update guest
              const eventGuest = document.getElementById(`eventGuest_${eventID}`).innerText;
              document.getElementById(`eventGuestInput_${eventID}`).value = eventGuest;

              // Update description
              const eventDescription = document.getElementById(`eventDescription_${eventID}`).innerText;
              document.getElementById(`eventDescriptionInput_${eventID}`).value = eventDescription;

              // Update capacity
              const eventCapacity = document.getElementById(`eventCapacity_${eventID}`).innerText;
              document.getElementById(`eventCapacityInput_${eventID}`).value = eventCapacity;

              // Update capacity
              const eventCategory = document.getElementById(`eventCategory_${eventID}`).innerText;
              document.getElementById(`eventCategoryInput_${eventID}`).value = eventCategory;

              // Update notes
              const eventNotes = document.getElementById(`eventNotes_${eventID}`).innerText;
              document.getElementById(`eventNotesInput_${eventID}`).value = eventNotes;

              const clubImage = document.getElementById(`clubImage-${eventID}`).getAttribute('src');
              document.getElementById(`clubimageInput_${eventID}`).value = clubImage;

              form.appendChild(clubImage);
              // Submit the form
              form.submit();
          });
      });
  });
</script>
          </div>
          <% }); %>
        </div>    
    </div>
    <div id="my-posts-content" class="content-section" style="display: none">
      <div class="container-fluid">
        <div class="row">
          <% Posts.forEach((post)=> { %>
            <div class="col-sm-3">
                <div >
                    <div style="background-color: black; height: 60px;" class="Post-card-header">
                        <img style="border-radius: 100%; width: 50px; height: 50px;" src="../public/images/<%= clubInformation[0].clubImageUrl%>" alt="">
                        <span style="color: white; font-size:24px"><%= clubInformation[0].club_name %></span>
                        <form action="/deletepost?postID=<%= post.PostID %>" method="POST" style="all: inherit; float: right; font-size: xx-large; color: white;" class="material-symbols-outlined">
                          <button type="submit" style="background-color: black;box-shadow: none;border:none;margin: 0;padding: 0; float: right; font-size: xx-large; color: white;" class="material-symbols-outlined">
                            <span style="float: right; font-size: xx-large; color: white;" class="material-symbols-outlined">
                            delete
                          </span>
                        </button>
                        </form> 
                          <span style="float: right; font-size: xx-large; color: white;" class="material-symbols-outlined">
                            edit
                          </span>
                    </div>
                    <div style="background-color: black;" class="Post-card-body">
                        <img width="100%" height="100%" src="../public/images/<%= post.postImageURL %>" alt="">
                    </div>
                    <div style="background-color: black;" class="Post-card-footer">
                        <span style="color: white; font-size: 20px">
                            <%= post.postText %>
                        </span>
                    </div>
                </div>
            </div>
            <% }); %>
        </div>
    </div>
  </div>
  
    <div id="my-status-content" class="content-section" style="display: none">
      <main class="table" id="customers_table">
        <section class="table__header">
          <h1>Requests Manager</h1>
          <div class="input-group">
            <input type="search" placeholder="Search Request...">
            <img src="/images/images/search.png" alt="search">
          </div>
        </section>

        <section class="table__body">
          <table>
            <thead>
              <tr>
                <th> Event Name</th>
                <th> Status</th>
                <th> Action </th>
              </tr>
            </thead>
            <tbody>
              <% if (Array.isArray(resultsToShare) && resultsToShare.length > 0) { %>
                <% resultsToShare.forEach((itemTs, index)=> { %>
                      <tr>
                        <td>
                          <%=itemTs.event_name%>
                        </td>
                        <td>
                          <p class="status approved">Approved</p>
                        </td>
                        <td>
                          <% var eventID=parseInt(itemTs.event_id); %>
                            <form action="/ToShareEvent?eventId=<%= eventID %>" method="POST">
                              <% var buttonId='button_' + itemTs.event_id; %>
                                <p><button id="<%= buttonId %>" class="approve-button" type="submit">Share</button></p>
                            </form>
                        </td>
                      </tr>
                <% }); %>
              <%}%>
              <% if (Array.isArray(resultsTemp) && resultsTemp.length > 0) { %>
                <% console.log("hi"); %>
                <% resultsTemp.forEach((item, index)=> { %>
                  <tr>
                    <td>
                      <%=item.event_name%>
                    </td>
                    <td>
                      <p class="status pending">Pending</p>
                    </td>
                  </tr>
                <% }); %>
              <%}%>
              <% if (Array.isArray(resultsHistory) && resultsHistory.length > 0) { %>
                <% resultsHistory.forEach((itemh, index)=> { %>
                    <tr>
                      <td>
                        <%if(itemh.status == 0){%>
                          <%=itemh.event_name%>
                          <%}%>
                      </td>
                      <td>
                        <%if(itemh.status==0){%>
                          <p class="status rejected">Rejected</p>
                          <%}%>
                      </td>
                    </tr>
                <% }); %>
              <%}%>
            </tbody>
          </table>
        </section>
    </div>
 
  <div id="my-notification-content" class="content-section" style="display: none">
    NOtifications
    
  </div>
  </div>
  </div>


  <!-- Footer -->
  <footer><%- include("partials/footer.ejs") %></footer>

  <!-- Scripts -->
  <script src="../public/scripts/MyClubPage Scripts/myclubpage.js"></script>
  <script src="../public/scripts/eventsRequests.js"></script>
</body>

</html>